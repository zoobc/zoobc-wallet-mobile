<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>{{ "task detail" | translate}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="reload($event)">
    <ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Pull to refresh" refreshingSpinner="circles"
      refreshingText="{{ 'Refreshing' | translate }} ...">
    </ion-refresher-content>
  </ion-refresher>
  <div *ngIf="isLoading" style="margin-top:5px;">
    <ion-progress-bar type="indeterminate"></ion-progress-bar>
  </div>

  <div style="text-align: center;">
    <h5> {{ "multi signature transaction detail" | translate}} </h5>
  </div>
  <ion-list *ngIf="multiSigDetail && !isLoading">
    <ion-item>
      <ion-label class="ion-text-wrap">
        <h5>{{ "hash" | translate }}</h5>
        <p class="info-val">
          {{ multiSigDetail.transactionHash}}
        </p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-wrap">
        <h5>{{ "sender" | translate }}</h5>
        <p class="info-val">
          {{ multiSigDetail.sender.value | shortAddress}}
        </p>
      </ion-label>
      <ion-icon class="info-val" slot="end" name="copy" (click)="copyAddress(multiSigDetail.sender.value)">
      </ion-icon>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-wrap">
        <h5>{{ "recipient" | translate }}</h5>
        <p class="info-val">
          {{ multiSigDetail.recipient.value | shortAddress }}
        </p>
      </ion-label>
      <ion-icon class="info-val" slot="end" name="copy" (click)="copyAddress(multiSigDetail.recipient.value)">
      </ion-icon>
    </ion-item>
    <ion-item>
      <ion-label>
        <h5>{{ "amount" | translate }}</h5>
        <p class="info-val">
          {{multiSigDetail.txBody.amount / 1e8 | number: '0.0-4' }} ZBC
        </p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label>
        <h5>{{ "fee" | translate }}</h5>
        <p class="info-val">
          {{ multiSigDetail.fee / 1e8 | number: '0.0-8' }} ZBC
        </p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-wrap">
        <h5>{{ "blockheight" | translate }}</h5>
        <p class="info-val">
          {{multiSigDetail.height}}
        </p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-wrap">
        <h5>{{ "date" | translate }}</h5>
        <p class="info-val">
          {{multiSigDetail.timestamp * 1000 | date: 'medium'}}
        </p>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label color="danger" *ngIf="totalPending == 0">
        <p> {{ "no participants have signed yet" | translate }}</p>
      </ion-label>
      <ng-container *ngIf="totalPending > 0">
      <ion-label color="danger">
        <p>Signed by {{ totalPending }} of {{ totalParticpants }}
          participants
        </p>
      </ion-label>
    </ng-container>
    </ion-item>

    <ion-item *ngIf="isNeedSign && enabledSign">
      <ion-checkbox [(ngModel)]="isNeedSign" color="primary"></ion-checkbox>
      <ion-label style="margin-left:10px;">{{ "sign this transaction" | translate}}</ion-label>
    </ion-item>

    <!-- <ion-item style="margin-bottom:50px;" *ngIf="!isNeedSign && enabledSign">
      <ion-checkbox [(ngModel)]="isNeedSign" color="primary"></ion-checkbox>
      <ion-label style="margin-left:10px;">{{ "sign this transaction" | translate}}</ion-label>
    </ion-item>

  </ion-list>

  <ng-container *ngIf="multiSigDetail && !isLoading && isNeedSign">
    <form [formGroup]="formSend" (ngSubmit)="submit()" novalidate>
      <ion-item lines="none" class="form-item">
        <!-- <ion-label position="stacked">{{"signed by" | translate}}</ion-label> -->
        <ion-label position="stacked">{{"approver" | translate}}</ion-label>
        <app-form-sender formControlName="sender" accountType="normal" canSwitch="yes" switchToActive="no"
          *ngIf="signers" predefList="{{signers}}" ngDefaultControl required></app-form-sender>
      </ion-item>

      <ion-item lines="none" class="form-item">
        <ion-label position="stacked">{{ "fee" | translate }}</ion-label>
        <app-form-amount-conversion formControlName="fee" ngDefaultControl required></app-form-amount-conversion>
        <ng-container *ngIf="( fFee.dirty || fFee.touched) && fFee.invalid">
          <ion-text class="text-error" *ngIf="fFee.errors.required">
            {{ "transaction fee cannot be empty" | translate}}
          </ion-text>
          <ion-text class="text-error" *ngIf="fFee.errors.min">
            {{ "transaction fee is not valid! minimum fee is" | translate}} {{ fFee.errors.min.min }}
          </ion-text>
        </ng-container>
      </ion-item>

      <ion-item class="btn" lines="none">
        <ion-button type="submit" size="medium" expand="full" color="tertiary">
          {{ 'send' | translate }}
        </ion-button>
      </ion-item>

    </form>
  </ng-container>
</ion-content>