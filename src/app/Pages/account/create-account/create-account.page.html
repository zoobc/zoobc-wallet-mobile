<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>{{ "add account" | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="formAccount" (ngSubmit)="submit()">
    <ion-list class="form-list">
      <ion-item lines="none" class="form-item">
        <ion-label position="stacked">{{ "account name" | translate }}</ion-label>
        <ion-input placeholder="{{ 'please enter your account name' | translate }}" formControlName="accountName" ngDefaultControl></ion-input>
        <ion-text class="text-error"
          *ngIf="(submitted || accountName.dirty || accountName.touched) && accountName.invalid && accountName.errors.required">
          {{ "account name cannot be empty" | translate}}
        </ion-text>
        <ion-text class="text-error"
          *ngIf="(submitted || accountName.dirty || accountName.touched) &&  accountName.invalid && accountName.errors.accountNameExists">
          {{accountName.errors.accountNameExists}}
        </ion-text>
      </ion-item>

      <ion-item *ngIf="multiSignAddress" lines="none" class="form-item">
        <ion-label position="stacked">{{'address' | translate}}</ion-label>
        <ion-textarea rows="3" readonly>
          {{multiSignAddress}}
        </ion-textarea>
      </ion-item>

      <ion-item *ngIf="from!='msig'" lines="none" class="form-item item-checkbox">
        <ion-checkbox (ionChange)="changeToMultisig($event.target.checked)" color="primary">
        </ion-checkbox>
        <ion-label>{{ "Multi-signature account" | translate}}</ion-label>
      </ion-item>
      <ng-container *ngIf="isMultisig">
        <ng-container formGroupName="participants">
          <ion-item lines="none" class="form-item" *ngFor="let participant of participants.controls; let i = index;" [formGroupName]="i">
            <ion-label position="stacked">{{ "participant" | translate }} {{ i+1 }}</ion-label>
            <app-form-get-address formControlName="address" (ionChange)="generateMsigAddress()" identity="recipient-{{ i }}"></app-form-get-address>
            <div class="form-feedback">
              <div>
                <ng-container *ngIf="(submitted || participants.controls[i].controls['address'].dirty || participants.controls[i].controls['address'].touched) && participants.controls[i].controls['address'].invalid">
                  <ion-text class="text-error" *ngIf="participants.controls[i].controls['address'].errors.required || participants.controls[i].controls['address'].errors.addressRequired">
                    {{ "address cannot be empty" | translate}}
                  </ion-text>
                  <ion-text class="text-error" *ngIf="participants.controls[i].controls['address'].errors.addressFormat">
                    {{ "address is wrong" | translate}}
                  </ion-text>
                </ng-container>
              </div>
              <span *ngIf="(i+1)>minimumParticipants" (click)="removeParticipant(i)" class="remove-account">
                <ion-icon name="zbc-trash"></ion-icon><span>{{ "remove" | translate }}</span>
              </span>
            </div>
          </ion-item>
          <ion-item lines="none" class="form-item">
            <ion-button slot="end" (click)="addParticipant()">{{ "add participant" | translate }}</ion-button>
          </ion-item>
        </ng-container>

        <ion-item lines="none" class="form-item">
          <ion-label position="stacked">{{ "Unique ID" | translate }}</ion-label>
          <ion-input formControlName="nonce" type="number" (ionChange)="generateMsigAddress()"></ion-input>
          <ng-container *ngIf="(submitted || nonce.dirty || nonce.touched) && nonce.invalid">
            <ion-text class="text-error" *ngIf="nonce.errors.required">
              {{ "nonce cannot be empty" | translate}}
            </ion-text>
            <ion-text class="text-error" *ngIf="nonce.errors.min">
              {{ "minimum nonce is 1" | translate}}
            </ion-text>
          </ng-container>
        </ion-item>

        <ion-item lines="none" class="form-item">
          <ion-label position="stacked">{{ "minimum signature" | translate }}</ion-label>
          <ion-input formControlName="minimumSignature" type="number" (ionChange)="generateMsigAddress()"></ion-input>
          <ng-container *ngIf="(submitted || minimumSignature.dirty || minimumSignature.touched) && minimumSignature.invalid">
            <ion-text class="text-error" *ngIf="minimumSignature.errors.required">
              {{ "minimum signature cannot be empty" | translate}}
            </ion-text>
            <ion-text class="text-error" *ngIf="minimumSignature.errors.min">
              {{ "minimum signature is 2" | translate}}
            </ion-text>
            <ion-text class="text-error" *ngIf="minimumSignature.errors.max">
              {{ "minimum signature cannot more than participants" | translate}}
            </ion-text>
          </ng-container>
        </ion-item>
      </ng-container>
    </ion-list>

    <ion-button strong color="tertiary" type="submit" expand="block">
      <span>{{"save"|translate}}</span>
    </ion-button>
  </form>  
</ion-content>